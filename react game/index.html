<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <title>React Image Matcher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
<div id="content"></div>
<script type="text/jsx">

    var App = {};

    var Container = React.createClass({
        render: function () {
            var imageCards = this.props.cards.map(function (card) {
                return (
                        <Image orderId={card.orderId} image={card.image}></Image>
                );
            });

            return (
                    <div className="container">
                        {imageCards}
                        <Button/>
                    </div>
            );
        }
    });

    var Image = React.createClass({
        getInitialState: function () {
            return {
                isShown: false,
                displayImg: ''
            };
        },
        handleClick: function () {
            console.log(this.props)

            if ( !this.state.isShown ) {
                this.setState({isShown: true, displayImg: this.props.image})
            }
        },
        render: function () {
            return (
                    <img src={this.state.displayImg} onClick={this.handleClick} className="imageCard">
                    </img>
            );
        }
    });

    var Button = React.createClass({
        getInitialState: function () {
            return {
                title: 'Start game',
                isStart: true
            };
        },
        handleClick: function () {
            if ( this.state.isStart ) {
                this.setState({isStart: false, title: 'Restart game'});
            } else {

                startApp();
            }
        },
        render: function () {
            return (
                    <button onClick={this.handleClick}>{this.state.title}</button>
            );
        }
    });


    startApp();

    function startApp() {
        App.cards = mixCards([
            'cat1.jpg',
            'cat2.jpg'
        ]);
        React.render(
                <Container cards={App.cards}/>,
                document.getElementById('content')
        );
    }

    function mixCards(imageArray) {
        var cardCount = imageArray.length * 2,
                mixedArray = _.shuffle(_.range(cardCount)),
                cards = [],
                tempImageArray = imageArray.concat(imageArray);

        for (var i = 0; i < cardCount; i++) {
            cards.push({orderId: mixedArray[ i ], image: tempImageArray[ i ]});
        }

        cards = _.sortBy(cards, 'orderId');
        console.log(cards)

        return cards;

    }
</script>
</body>

</html>
